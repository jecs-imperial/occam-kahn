'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var arrayUtil = require('./util/array'),
    Edge = require('./graph/edge'),
    Vertex = require('./graph/vertex'),
    RemainingEdges = require('./graph/remainingEdges');

var Graph = function () {
  function Graph(topologicallyOrderedVertices, remainingEdges) {
    _classCallCheck(this, Graph);

    this.topologicallyOrderedVertices = topologicallyOrderedVertices;
    this.remainingEdges = remainingEdges;
  }

  _createClass(Graph, [{
    key: 'getTopologicallyOrderedVertices',
    value: function getTopologicallyOrderedVertices() {
      return this.topologicallyOrderedVertices;
    }
  }, {
    key: 'getRemainingEdges',
    value: function getRemainingEdges() {
      return this.remainingEdges;
    }
  }, {
    key: 'areCyclesPresent',
    value: function areCyclesPresent() {
      return this.remainingEdges.areCyclesPresent();
    }
  }], [{
    key: 'fromVertexNamesAndEdges',
    value: function fromVertexNamesAndEdges(vertexNames, edges) {
      var vertexMap = vertexMapFromVertexNamesAndEdges(vertexNames, edges),
          topologicallyOrderedVertices = topologicallyOrderedVerticesFromVertexMapAndEdges(vertexMap, edges),
          remainingEdges = new RemainingEdges(edges),
          graph = new Graph(topologicallyOrderedVertices, remainingEdges);

      return graph;
    }
  }, {
    key: 'fromVertexLiterals',
    value: function fromVertexLiterals(vertexLiterals) {
      var vertexMap = vertexMapFromVertexLiterals(vertexLiterals),
          edges = edgesFromVertexLiteralsAndVertexMap(vertexLiterals, vertexMap),
          topologicallyOrderedVertices = topologicallyOrderedVerticesFromVertexMapAndEdges(vertexMap, edges),
          remainingEdges = new RemainingEdges(edges),
          graph = new Graph(topologicallyOrderedVertices, remainingEdges);

      return graph;
    }
  }]);

  return Graph;
}();

module.exports = Graph;

function vertexMapFromVertexNamesAndEdges(vertexNames, edges) {
  var vertexMap = {};

  vertexNames.forEach(function (vertexName) {
    var vertexExists = vertexMap.hasOwnProperty(vertexName);

    if (!vertexExists) {
      var vertex = Vertex.fromVertexName(vertexName);

      vertexMap[vertexName] = vertex;
    }
  });

  edges.forEach(function (edge) {
    var sourceVertexName = edge.getSourceVertexName(),
        targetVertexName = edge.getTargetVertexName(),
        sourceVertexExists = vertexMap.hasOwnProperty(sourceVertexName),
        targetVertexExists = vertexMap.hasOwnProperty(targetVertexName);

    if (!sourceVertexExists) {
      var _sourceVertex = Vertex.fromVertexName(sourceVertexName);

      vertexMap[sourceVertexName] = _sourceVertex;
    }

    if (!targetVertexExists) {
      var _targetVertex = Vertex.fromVertexName(targetVertexName);

      vertexMap[targetVertexName] = _targetVertex;
    }

    var sourceVertex = vertexMap[sourceVertexName],
        targetVertex = vertexMap[targetVertexName],
        incomingEdge = edge,
        ///
    outgoingEdge = edge; ///

    sourceVertex.addOutgoingEdge(outgoingEdge);

    targetVertex.addIncomingEdge(incomingEdge);
  });

  return vertexMap;
}

function vertexMapFromVertexLiterals(vertexLiterals) {
  var vertexMap = {};

  vertexLiterals.forEach(function (vertexLiteral) {
    var firstVertexLiteralElement = arrayUtil.first(vertexLiteral),
        vertexName = firstVertexLiteralElement,
        ///
    vertexExists = vertexMap.hasOwnProperty(vertexName);

    if (!vertexExists) {
      var vertex = Vertex.fromVertexName(vertexName);

      vertexMap[vertexName] = vertex;
    }

    var secondVertexLiteralElement = arrayUtil.second(vertexLiteral),
        ancestorVertexNames = secondVertexLiteralElement; ///

    ancestorVertexNames.forEach(function (ancestorVertexName) {
      var ancestorVertexExists = vertexMap.hasOwnProperty(ancestorVertexName);

      if (!ancestorVertexExists) {
        var ancestorVertex = Vertex.fromVertexName(ancestorVertexName);

        vertexMap[ancestorVertexName] = ancestorVertex;
      }
    });
  });

  return vertexMap;
}

function edgesFromVertexLiteralsAndVertexMap(vertexLiterals, vertexMap) {
  var edges = [];

  vertexLiterals.forEach(function (vertexLiteral) {
    var firstVertexLiteralElement = arrayUtil.first(vertexLiteral),
        secondVertexLiteralElement = arrayUtil.second(vertexLiteral),
        ancestorVertexNames = secondVertexLiteralElement,
        ///
    vertexName = firstVertexLiteralElement; ///

    ancestorVertexNames.forEach(function (ancestorVertexName) {
      var sourceVertexName = ancestorVertexName,
          ///
      targetVertexName = vertexName,
          ///
      sourceVertex = vertexMap[sourceVertexName],
          targetVertex = vertexMap[targetVertexName],
          edge = new Edge(sourceVertexName, targetVertexName),
          incomingEdge = edge,
          ///
      outgoingEdge = edge; ///

      edges.push(edge);

      sourceVertex.addOutgoingEdge(outgoingEdge);

      targetVertex.addIncomingEdge(incomingEdge);
    });
  });

  return edges;
}

function topologicallyOrderedVerticesFromVertexMapAndEdges(vertexMap, edges) {
  var topologicallyOrderedVertexNames = [],
      startingVertexNames = startingVertexNamesFromVertexMap(vertexMap),
      removedEdges = [];

  var startingVertexNamesLength = startingVertexNames.length;

  var _loop = function _loop() {
    var startingVertexName = startingVertexNames.pop(),
        topologicallyOrderedVertexName = startingVertexName; ///

    topologicallyOrderedVertexNames.push(topologicallyOrderedVertexName);

    arrayUtil.backwardsForEach(edges, function (edge, index) {
      var sourceVertexName = edge.getSourceVertexName(),
          edgeStarting = sourceVertexName === startingVertexName; ///

      if (edgeStarting) {
        edges.splice(index, 1);

        var targetVertexName = edge.getTargetVertexName(),
            targetVertex = vertexMap[targetVertexName],
            incomingEdge = edge,
            ///
        removedEdge = edge; ///

        targetVertex.removeIncomingEdge(incomingEdge);

        removedEdges.push(removedEdge);

        var targetVertexStarting = targetVertex.isStarting();

        if (targetVertexStarting) {
          var _startingVertexName = targetVertexName; ///

          startingVertexNames.push(_startingVertexName);
        }
      }
    });

    startingVertexNamesLength = startingVertexNames.length;
  };

  while (startingVertexNamesLength > 0) {
    _loop();
  }

  var edgesLength = edges.length;

  if (edgesLength === 0) {
    removedEdges.forEach(function (removedEdge) {
      var targetVertexName = removedEdge.getTargetVertexName(),
          targetVertex = vertexMap[targetVertexName],
          incomingEdge = removedEdge; ///

      targetVertex.addIncomingEdge(incomingEdge);
    });
  }

  var topologicallySortedVertices = topologicallyOrderedVertexNames.map(function (topologicallyOrderedVertexName) {
    var topologicallyOrderedVertex = vertexMap[topologicallyOrderedVertexName];

    return topologicallyOrderedVertex;
  });

  return topologicallySortedVertices;
}

function startingVertexNamesFromVertexMap(vertexMap) {
  var vertexNames = Object.keys(vertexMap),
      startingVertexNames = vertexNames.reduce(function (startingVertexNames, vertexName) {
    var vertex = vertexMap[vertexName],
        vertexStarting = vertex.isStarting();

    if (vertexStarting) {
      var _startingVertexName2 = vertexName; ///

      startingVertexNames.push(_startingVertexName2);
    }

    return startingVertexNames;
  }, []);

  return startingVertexNames;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9ncmFwaC5qcyJdLCJuYW1lcyI6WyJhcnJheVV0aWwiLCJyZXF1aXJlIiwiRWRnZSIsIlZlcnRleCIsIlJlbWFpbmluZ0VkZ2VzIiwiR3JhcGgiLCJ0b3BvbG9naWNhbGx5T3JkZXJlZFZlcnRpY2VzIiwicmVtYWluaW5nRWRnZXMiLCJhcmVDeWNsZXNQcmVzZW50IiwidmVydGV4TmFtZXMiLCJlZGdlcyIsInZlcnRleE1hcCIsInZlcnRleE1hcEZyb21WZXJ0ZXhOYW1lc0FuZEVkZ2VzIiwidG9wb2xvZ2ljYWxseU9yZGVyZWRWZXJ0aWNlc0Zyb21WZXJ0ZXhNYXBBbmRFZGdlcyIsImdyYXBoIiwidmVydGV4TGl0ZXJhbHMiLCJ2ZXJ0ZXhNYXBGcm9tVmVydGV4TGl0ZXJhbHMiLCJlZGdlc0Zyb21WZXJ0ZXhMaXRlcmFsc0FuZFZlcnRleE1hcCIsIm1vZHVsZSIsImV4cG9ydHMiLCJmb3JFYWNoIiwidmVydGV4TmFtZSIsInZlcnRleEV4aXN0cyIsImhhc093blByb3BlcnR5IiwidmVydGV4IiwiZnJvbVZlcnRleE5hbWUiLCJlZGdlIiwic291cmNlVmVydGV4TmFtZSIsImdldFNvdXJjZVZlcnRleE5hbWUiLCJ0YXJnZXRWZXJ0ZXhOYW1lIiwiZ2V0VGFyZ2V0VmVydGV4TmFtZSIsInNvdXJjZVZlcnRleEV4aXN0cyIsInRhcmdldFZlcnRleEV4aXN0cyIsInNvdXJjZVZlcnRleCIsInRhcmdldFZlcnRleCIsImluY29taW5nRWRnZSIsIm91dGdvaW5nRWRnZSIsImFkZE91dGdvaW5nRWRnZSIsImFkZEluY29taW5nRWRnZSIsInZlcnRleExpdGVyYWwiLCJmaXJzdFZlcnRleExpdGVyYWxFbGVtZW50IiwiZmlyc3QiLCJzZWNvbmRWZXJ0ZXhMaXRlcmFsRWxlbWVudCIsInNlY29uZCIsImFuY2VzdG9yVmVydGV4TmFtZXMiLCJhbmNlc3RvclZlcnRleE5hbWUiLCJhbmNlc3RvclZlcnRleEV4aXN0cyIsImFuY2VzdG9yVmVydGV4IiwicHVzaCIsInRvcG9sb2dpY2FsbHlPcmRlcmVkVmVydGV4TmFtZXMiLCJzdGFydGluZ1ZlcnRleE5hbWVzIiwic3RhcnRpbmdWZXJ0ZXhOYW1lc0Zyb21WZXJ0ZXhNYXAiLCJyZW1vdmVkRWRnZXMiLCJzdGFydGluZ1ZlcnRleE5hbWVzTGVuZ3RoIiwibGVuZ3RoIiwic3RhcnRpbmdWZXJ0ZXhOYW1lIiwicG9wIiwidG9wb2xvZ2ljYWxseU9yZGVyZWRWZXJ0ZXhOYW1lIiwiYmFja3dhcmRzRm9yRWFjaCIsImluZGV4IiwiZWRnZVN0YXJ0aW5nIiwic3BsaWNlIiwicmVtb3ZlZEVkZ2UiLCJyZW1vdmVJbmNvbWluZ0VkZ2UiLCJ0YXJnZXRWZXJ0ZXhTdGFydGluZyIsImlzU3RhcnRpbmciLCJlZGdlc0xlbmd0aCIsInRvcG9sb2dpY2FsbHlTb3J0ZWRWZXJ0aWNlcyIsIm1hcCIsInRvcG9sb2dpY2FsbHlPcmRlcmVkVmVydGV4IiwiT2JqZWN0Iiwia2V5cyIsInJlZHVjZSIsInZlcnRleFN0YXJ0aW5nIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FBRUEsSUFBTUEsWUFBWUMsUUFBUSxjQUFSLENBQWxCO0FBQUEsSUFDTUMsT0FBT0QsUUFBUSxjQUFSLENBRGI7QUFBQSxJQUVNRSxTQUFTRixRQUFRLGdCQUFSLENBRmY7QUFBQSxJQUdNRyxpQkFBaUJILFFBQVEsd0JBQVIsQ0FIdkI7O0lBS01JLEs7QUFDSixpQkFBYUMsNEJBQWIsRUFBMkNDLGNBQTNDLEVBQTJEO0FBQUE7O0FBQ3pELFNBQUtELDRCQUFMLEdBQW9DQSw0QkFBcEM7QUFDQSxTQUFLQyxjQUFMLEdBQXNCQSxjQUF0QjtBQUNEOzs7O3NEQUVpQztBQUNoQyxhQUFPLEtBQUtELDRCQUFaO0FBQ0Q7Ozt3Q0FFbUI7QUFDbEIsYUFBTyxLQUFLQyxjQUFaO0FBQ0Q7Ozt1Q0FFa0I7QUFBRSxhQUFPLEtBQUtBLGNBQUwsQ0FBb0JDLGdCQUFwQixFQUFQO0FBQWdEOzs7NENBRXRDQyxXLEVBQWFDLEssRUFBTztBQUNqRCxVQUFNQyxZQUFZQyxpQ0FB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U3RCLG1CQUFULEVBQThCN0IsVUFBOUIsRUFBMEM7QUFDakYsUUFBTUcsU0FBU2IsVUFBVVUsVUFBVixDQUFmO0FBQUEsUUFDTW9ELGlCQUFpQmpELE9BQU95QyxVQUFQLEVBRHZCOztBQUdBLFFBQUlRLGNBQUosRUFBb0I7QUFDbEIsVUFBTWxCLHVCQUFxQmxDLFVBQTNCLENBRGtCLENBQ3NCOztBQUV4QzZCLDBCQUFvQkYsSUFBcEIsQ0FBeUJPLG9CQUF6QjtBQUNEOztBQUVELFdBQU9MLG1CQUFQO0FBQ0QsR0FYcUIsRUFXbkIsRUFYbUIsQ0FENUI7O0FBY0EsU0FBT0EsbUJBQVA7QUFDRCIsImZpbGUiOiJncmFwaC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuY29uc3QgYXJyYXlVdGlsID0gcmVxdWlyZSgnLi91dGlsL2FycmF5JyksXG4gICAgICBFZGdlID0gcmVxdWlyZSgnLi9ncmFwaC9lZGdlJyksXG4gICAgICBWZXJ0ZXggPSByZXF1aXJlKCcuL2dyYXBoL3ZlcnRleCcpLFxuICAgICAgUmVtYWluaW5nRWRnZXMgPSByZXF1aXJlKCcuL2dyYXBoL3JlbWFpbmluZ0VkZ2VzJyk7XG5cbmNsYXNzIEdyYXBoIHtcbiAgY29uc3RydWN0b3IgKHRvcG9sb2dpY2FsbHlPcmRlcmVkVmVydGljZXMsIHJlbWFpbmluZ0VkZ2VzKSB7XG4gICAgdGhpcy50b3BvbG9naWNhbGx5T3JkZXJlZFZlcnRpY2VzID0gdG9wb2xvZ2ljYWxseU9yZGVyZWRWZXJ0aWNlcztcbiAgICB0aGlzLnJlbWFpbmluZ0VkZ2VzID0gcmVtYWluaW5nRWRnZXM7XG4gIH1cblxuICBnZXRUb3BvbG9naWNhbGx5T3JkZXJlZFZlcnRpY2VzKCkge1xuICAgIHJldHVybiB0aGlzLnRvcG9sb2dpY2FsbHlPcmRlcmVkVmVydGljZXM7XG4gIH1cblxuICBnZXRSZW1haW5pbmdFZGdlcygpIHtcbiAgICByZXR1cm4gdGhpcy5yZW1haW5pbmdFZGdlcztcbiAgfVxuXG4gIGFyZUN5Y2xlc1ByZXNlbnQoKSB7IHJldHVybiB0aGlzLnJlbWFpbmluZ0VkZ2VzLmFyZUN5Y2xlc1ByZXNlbnQoKTsgfVxuXG4gIHN0YXRpYyBmcm9tVmVydGV4TmFtZXNBbmRFZGdlcyh2ZXJ0ZXhOYW1lcywgZWRnZXMpIHtcbiAgICBjb25zdCB2ZXJ0ZXhNYXAgPSB2ZXJ0ZXhNYXBGcm9tVmVydGV4TmFtZXNBbmRFZGdlcyh2ZXJ0ZXhOYW1lcywgZWRnZXMpLFxuICAgICAgICAgIHRvcG9sb2dpY2FsbHlPcmRlcmVkVmVydGljZXMgPSB0b3BvbG9naWNhbGx5T3JkZXJlZFZlcnRpY2VzRnJvbVZlcnRleE1hcEFuZEVkZ2VzKHZlcnRleE1hcCwgZWRnZXMpLFxuICAgICAgICAgIHJlbWFpbmluZ0VkZ2VzID0gbmV3IFJlbWFpbmluZ0VkZ2VzKGVkZ2VzKSxcbiAgICAgICAgICBncmFwaCA9IG5ldyBHcmFwaCh0b3BvbG9naWNhbGx5T3JkZXJlZFZlcnRpY2VzLCByZW1haW5pbmdFZGdlcyk7XG5cbiAgICByZXR1cm4gZ3JhcGg7XG4gIH1cblxuICBzdGF0aWMgZnJvbVZlcnRleExpdGVyYWxzKHZlcnRleExpdGVyYWxzKSB7XG4gICAgY29uc3QgdmVydGV4TWFwID0gdmVydGV4TWFwRnJvbVZlcnRleExpdGVyYWxzKHZlcnRleExpdGVyYWxzKSxcbiAgICAgICAgICBlZGdlcyA9IGVkZ2VzRnJvbVZlcnRleExpdGVyYWxzQW5kVmVydGV4TWFwKHZlcnRleExpdGVyYWxzLCB2ZXJ0ZXhNYXApLFxuICAgICAgICAgIHRvcG9sb2dpY2FsbHlPcmRlcmVkVmVydGljZXMgPSB0b3BvbG9naWNhbGx5T3JkZXJlZFZlcnRpY2VzRnJvbVZlcnRleE1hcEFuZEVkZ2VzKHZlcnRleE1hcCwgZWRnZXMpLFxuICAgICAgICAgIHJlbWFpbmluZ0VkZ2VzID0gbmV3IFJlbWFpbmluZ0VkZ2VzKGVkZ2VzKSxcbiAgICAgICAgICBncmFwaCA9IG5ldyBHcmFwaCh0b3BvbG9naWNhbGx5T3JkZXJlZFZlcnRpY2VzLCByZW1haW5pbmdFZGdlcyk7XG5cbiAgICByZXR1cm4gZ3JhcGg7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBHcmFwaDtcblxuZnVuY3Rpb24gdmVydGV4TWFwRnJvbVZlcnRleE5hbWVzQW5kRWRnZXModmVydGV4TmFtZXMsIGVkZ2VzKSB7XG4gIGNvbnN0IHZlcnRleE1hcCA9IHt9O1xuXG4gIHZlcnRleE5hbWVzLmZvckVhY2goZnVuY3Rpb24odmVydGV4TmFtZSkge1xuICAgIGNvbnN0IHZlcnRleEV4aXN0cyA9IHZlcnRleE1hcC5oYXNPd25Qcm9wZXJ0eSh2ZXJ0ZXhOYW1lKTtcblxuICAgIGlmICghdmVydGV4RXhpc3RzKSB7XG4gICAgICBjb25zdCB2ZXJ0ZXggPSBWZXJ0ZXguZnJvbVZlcnRleE5hbWUodmVydGV4TmFtZSk7XG5cbiAgICAgIHZlcnRleE1hcFt2ZXJ0ZXhOYW1lXSA9IHZlcnRleDtcbiAgICB9XG4gIH0pO1xuXG4gIGVkZ2VzLmZvckVhY2goZnVuY3Rpb24oZWRnZSkge1xuICAgIGNvbnN0IHNvdXJjZVZlcnRleE5hbWUgPSBlZGdlLmdldFNvdXJjZVZlcnRleE5hbWUoKSxcbiAgICAgICAgICB0YXJnZXRWZXJ0ZXhOYW1lID0gZWRnZS5nZXRUYXJnZXRWZXJ0ZXhOYW1lKCksXG4gICAgICAgICAgc291cmNlVmVydGV4RXhpc3RzID0gdmVydGV4TWFwLmhhc093blByb3BlcnR5KHNvdXJjZVZlcnRleE5hbWUpLFxuICAgICAgICAgIHRhcmdldFZlcnRleEV4aXN0cyA9IHZlcnRleE1hcC5oYXNPd25Qcm9wZXJ0eSh0YXJnZXRWZXJ0ZXhOYW1lKTtcblxuICAgIGlmICghc291cmNlVmVydGV4RXhpc3RzKSB7XG4gICAgICBjb25zdCBzb3VyY2VWZXJ0ZXggPSBWZXJ0ZXguZnJvbVZlcnRleE5hbWUoc291cmNlVmVydGV4TmFtZSk7XG5cbiAgICAgIHZlcnRleE1hcFtzb3VyY2VWZXJ0ZXhOYW1lXSA9IHNvdXJjZVZlcnRleDtcbiAgICB9XG5cbiAgICBpZiAoIXRhcmdldFZlcnRleEV4aXN0cykge1xuICAgICAgY29uc3QgdGFyZ2V0VmVydGV4ID0gVmVydGV4LmZyb21WZXJ0ZXhOYW1lKHRhcmdldFZlcnRleE5hbWUpO1xuXG4gICAgICB2ZXJ0ZXhNYXBbdGFyZ2V0VmVydGV4TmFtZV0gPSB0YXJnZXRWZXJ0ZXg7XG4gICAgfVxuXG4gICAgY29uc3Qgc291cmNlVmVydGV4ID0gdmVydGV4TWFwW3NvdXJjZVZlcnRleE5hbWVdLFxuICAgICAgICAgIHRhcmdldFZlcnRleCA9IHZlcnRleE1hcFt0YXJnZXRWZXJ0ZXhOYW1lXSxcbiAgICAgICAgICBpbmNvbWluZ0VkZ2UgPSBlZGdlLCAgLy8vXG4gICAgICAgICAgb3V0Z29pbmdFZGdlID0gZWRnZTsgIC8vL1xuXG4gICAgc291cmNlVmVydGV4LmFkZE91dGdvaW5nRWRnZShvdXRnb2luZ0VkZ2UpO1xuXG4gICAgdGFyZ2V0VmVydGV4LmFkZEluY29taW5nRWRnZShpbmNvbWluZ0VkZ2UpO1xuICB9KTtcblxuICByZXR1cm4gdmVydGV4TWFwO1xufVxuXG5mdW5jdGlvbiB2ZXJ0ZXhNYXBGcm9tVmVydGV4TGl0ZXJhbHModmVydGV4TGl0ZXJhbHMpIHtcbiAgY29uc3QgdmVydGV4TWFwID0ge307XG5cbiAgdmVydGV4TGl0ZXJhbHMuZm9yRWFjaChmdW5jdGlvbih2ZXJ0ZXhMaXRlcmFsKSB7XG4gICAgY29uc3QgZmlyc3RWZXJ0ZXhMaXRlcmFsRWxlbWVudCA9IGFycmF5VXRpbC5maXJzdCh2ZXJ0ZXhMaXRlcmFsKSxcbiAgICAgICAgICB2ZXJ0ZXhOYW1lID0gZmlyc3RWZXJ0ZXhMaXRlcmFsRWxlbWVudCwgLy8vXG4gICAgICAgICAgdmVydGV4RXhpc3RzID0gdmVydGV4TWFwLmhhc093blByb3BlcnR5KHZlcnRleE5hbWUpO1xuXG4gICAgaWYgKCF2ZXJ0ZXhFeGlzdHMpIHtcbiAgICAgIGNvbnN0IHZlcnRleCA9IFZlcnRleC5mcm9tVmVydGV4TmFtZSh2ZXJ0ZXhOYW1lKTtcblxuICAgICAgdmVydGV4TWFwW3ZlcnRleE5hbWVdID0gdmVydGV4O1xuICAgIH1cblxuICAgIGNvbnN0IHNlY29uZFZlcnRleExpdGVyYWxFbGVtZW50ID0gYXJyYXlVdGlsLnNlY29uZCh2ZXJ0ZXhMaXRlcmFsKSxcbiAgICAgICAgICBhbmNlc3RvclZlcnRleE5hbWVzID0gc2Vjb25kVmVydGV4TGl0ZXJhbEVsZW1lbnQ7IC8vL1xuXG4gICAgYW5jZXN0b3JWZXJ0ZXhOYW1lcy5mb3JFYWNoKGZ1bmN0aW9uKGFuY2VzdG9yVmVydGV4TmFtZSkge1xuICAgICAgY29uc3QgYW5jZXN0b3JWZXJ0ZXhFeGlzdHMgPSB2ZXJ0ZXhNYXAuaGFzT3duUHJvcGVydHkoYW5jZXN0b3JWZXJ0ZXhOYW1lKTtcblxuICAgICAgaWYgKCFhbmNlc3RvclZlcnRleEV4aXN0cykge1xuICAgICAgICBjb25zdCBhbmNlc3RvclZlcnRleCA9IFZlcnRleC5mcm9tVmVydGV4TmFtZShhbmNlc3RvclZlcnRleE5hbWUpO1xuXG4gICAgICAgIHZlcnRleE1hcFthbmNlc3RvclZlcnRleE5hbWVdID0gYW5jZXN0b3JWZXJ0ZXg7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIHJldHVybiB2ZXJ0ZXhNYXA7XG59XG5cbmZ1bmN0aW9uIGVkZ2VzRnJvbVZlcnRleExpdGVyYWxzQW5kVmVydGV4TWFwKHZlcnRleExpdGVyYWxzLCB2ZXJ0ZXhNYXApIHtcbiAgY29uc3QgZWRnZXMgPSBbXTtcblxuICB2ZXJ0ZXhMaXRlcmFscy5mb3JFYWNoKGZ1bmN0aW9uKHZlcnRleExpdGVyYWwpIHtcbiAgICBjb25zdCBmaXJzdFZlcnRleExpdGVyYWxFbGVtZW50ID0gYXJyYXlVdGlsLmZpcnN0KHZlcnRleExpdGVyYWwpLFxuICAgICAgICAgIHNlY29uZFZlcnRleExpdGVyYWxFbGVtZW50ID0gYXJyYXlVdGlsLnNlY29uZCh2ZXJ0ZXhMaXRlcmFsKSxcbiAgICAgICAgICBhbmNlc3RvclZlcnRleE5hbWVzID0gc2Vjb25kVmVydGV4TGl0ZXJhbEVsZW1lbnQsIC8vL1xuICAgICAgICAgIHZlcnRleE5hbWUgPSBmaXJzdFZlcnRleExpdGVyYWxFbGVtZW50OyAvLy9cblxuICAgIGFuY2VzdG9yVmVydGV4TmFtZXMuZm9yRWFjaChmdW5jdGlvbihhbmNlc3RvclZlcnRleE5hbWUpIHtcbiAgICAgIGNvbnN0IHNvdXJjZVZlcnRleE5hbWUgPSBhbmNlc3RvclZlcnRleE5hbWUsIC8vL1xuICAgICAgICAgICAgdGFyZ2V0VmVydGV4TmFtZSA9IHZlcnRleE5hbWUsICAvLy9cbiAgICAgICAgICAgIHNvdXJjZVZlcnRleCA9IHZlcnRleE1hcFtzb3VyY2VWZXJ0ZXhOYW1lXSxcbiAgICAgICAgICAgIHRhcmdldFZlcnRleCA9IHZlcnRleE1hcFt0YXJnZXRWZXJ0ZXhOYW1lXSxcbiAgICAgICAgICAgIGVkZ2UgPSBuZXcgRWRnZShzb3VyY2VWZXJ0ZXhOYW1lLCB0YXJnZXRWZXJ0ZXhOYW1lKSxcbiAgICAgICAgICAgIGluY29taW5nRWRnZSA9IGVkZ2UsICAvLy9cbiAgICAgICAgICAgIG91dGdvaW5nRWRnZSA9IGVkZ2U7ICAvLy9cblxuICAgICAgZWRnZXMucHVzaChlZGdlKTtcblxuICAgICAgc291cmNlVmVydGV4LmFkZE91dGdvaW5nRWRnZShvdXRnb2luZ0VkZ2UpO1xuXG4gICAgICB0YXJnZXRWZXJ0ZXguYWRkSW5jb21pbmdFZGdlKGluY29taW5nRWRnZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIHJldHVybiBlZGdlcztcbn1cblxuZnVuY3Rpb24gdG9wb2xvZ2ljYWxseU9yZGVyZWRWZXJ0aWNlc0Zyb21WZXJ0ZXhNYXBBbmRFZGdlcyh2ZXJ0ZXhNYXAsIGVkZ2VzKSB7XG4gIGNvbnN0IHRvcG9sb2dpY2FsbHlPcmRlcmVkVmVydGV4TmFtZXMgPSBbXSxcbiAgICAgICAgc3RhcnRpbmdWZXJ0ZXhOYW1lcyA9IHN0YXJ0aW5nVmVydGV4TmFtZXNGcm9tVmVydGV4TWFwKHZlcnRleE1hcCksXG4gICAgICAgIHJlbW92ZWRFZGdlcyA9IFtdO1xuXG4gIGxldCBzdGFydGluZ1ZlcnRleE5hbWVzTGVuZ3RoID0gc3RhcnRpbmdWZXJ0ZXhOYW1lcy5sZW5ndGg7XG5cbiAgd2hpbGUgKHN0YXJ0aW5nVmVydGV4TmFtZXNMZW5ndGggPiAwKSB7XG4gICAgY29uc3Qgc3RhcnRpbmdWZXJ0ZXhOYW1lID0gc3RhcnRpbmdWZXJ0ZXhOYW1lcy5wb3AoKSxcbiAgICAgICAgICB0b3BvbG9naWNhbGx5T3JkZXJlZFZlcnRleE5hbWUgPSBzdGFydGluZ1ZlcnRleE5hbWU7ICAvLy9cblxuICAgIHRvcG9sb2dpY2FsbHlPcmRlcmVkVmVydGV4TmFtZXMucHVzaCh0b3BvbG9naWNhbGx5T3JkZXJlZFZlcnRleE5hbWUpO1xuXG4gICAgYXJyYXlVdGlsLmJhY2t3YXJkc0ZvckVhY2goZWRnZXMsIGZ1bmN0aW9uKGVkZ2UsIGluZGV4KSB7XG4gICAgICBjb25zdCBzb3VyY2VWZXJ0ZXhOYW1lID0gZWRnZS5nZXRTb3VyY2VWZXJ0ZXhOYW1lKCksXG4gICAgICAgICAgICBlZGdlU3RhcnRpbmcgPSAoc291cmNlVmVydGV4TmFtZSA9PT0gc3RhcnRpbmdWZXJ0ZXhOYW1lKTsgLy8vXG5cbiAgICAgIGlmIChlZGdlU3RhcnRpbmcpIHtcbiAgICAgICAgZWRnZXMuc3BsaWNlKGluZGV4LCAxKTtcblxuICAgICAgICBjb25zdCB0YXJnZXRWZXJ0ZXhOYW1lID0gZWRnZS5nZXRUYXJnZXRWZXJ0ZXhOYW1lKCksXG4gICAgICAgICAgICAgIHRhcmdldFZlcnRleCA9IHZlcnRleE1hcFt0YXJnZXRWZXJ0ZXhOYW1lXSxcbiAgICAgICAgICAgICAgaW5jb21pbmdFZGdlID0gZWRnZSwgLy8vXG4gICAgICAgICAgICAgIHJlbW92ZWRFZGdlID0gZWRnZTsgIC8vL1xuXG4gICAgICAgIHRhcmdldFZlcnRleC5yZW1vdmVJbmNvbWluZ0VkZ2UoaW5jb21pbmdFZGdlKTtcblxuICAgICAgICByZW1vdmVkRWRnZXMucHVzaChyZW1vdmVkRWRnZSk7XG5cbiAgICAgICAgY29uc3QgdGFyZ2V0VmVydGV4U3RhcnRpbmcgPSB0YXJnZXRWZXJ0ZXguaXNTdGFydGluZygpO1xuXG4gICAgICAgIGlmICh0YXJnZXRWZXJ0ZXhTdGFydGluZykge1xuICAgICAgICAgIGNvbnN0IHN0YXJ0aW5nVmVydGV4TmFtZSA9IHRhcmdldFZlcnRleE5hbWU7ICAvLy9cblxuICAgICAgICAgIHN0YXJ0aW5nVmVydGV4TmFtZXMucHVzaChzdGFydGluZ1ZlcnRleE5hbWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBzdGFydGluZ1ZlcnRleE5hbWVzTGVuZ3RoID0gc3RhcnRpbmdWZXJ0ZXhOYW1lcy5sZW5ndGg7XG4gIH1cblxuICBjb25zdCBlZGdlc0xlbmd0aCA9IGVkZ2VzLmxlbmd0aDtcblxuICBpZiAoZWRnZXNMZW5ndGggPT09IDApIHtcbiAgICByZW1vdmVkRWRnZXMuZm9yRWFjaChmdW5jdGlvbihyZW1vdmVkRWRnZSkge1xuICAgICAgY29uc3QgdGFyZ2V0VmVydGV4TmFtZSA9IHJlbW92ZWRFZGdlLmdldFRhcmdldFZlcnRleE5hbWUoKSxcbiAgICAgICAgICAgIHRhcmdldFZlcnRleCA9IHZlcnRleE1hcFt0YXJnZXRWZXJ0ZXhOYW1lXSxcbiAgICAgICAgICAgIGluY29taW5nRWRnZSA9IHJlbW92ZWRFZGdlOyAvLy9cbiAgICAgIFxuICAgICAgdGFyZ2V0VmVydGV4LmFkZEluY29taW5nRWRnZShpbmNvbWluZ0VkZ2UpO1xuICAgIH0pXG4gIH1cblxuICBjb25zdCB0b3BvbG9naWNhbGx5U29ydGVkVmVydGljZXMgPSB0b3BvbG9naWNhbGx5T3JkZXJlZFZlcnRleE5hbWVzLm1hcChmdW5jdGlvbih0b3BvbG9naWNhbGx5T3JkZXJlZFZlcnRleE5hbWUpIHtcbiAgICBjb25zdCB0b3BvbG9naWNhbGx5T3JkZXJlZFZlcnRleCA9IHZlcnRleE1hcFt0b3BvbG9naWNhbGx5T3JkZXJlZFZlcnRleE5hbWVdO1xuXG4gICAgcmV0dXJuIHRvcG9sb2dpY2FsbHlPcmRlcmVkVmVydGV4O1xuICB9KTtcblxuICByZXR1cm4gdG9wb2xvZ2ljYWxseVNvcnRlZFZlcnRpY2VzO1xufVxuXG5mdW5jdGlvbiBzdGFydGluZ1ZlcnRleE5hbWVzRnJvbVZlcnRleE1hcCh2ZXJ0ZXhNYXApIHtcbiAgY29uc3QgdmVydGV4TmFtZXMgPSBPYmplY3Qua2V5cyh2ZXJ0ZXhNYXApLFxuICAgICAgICBzdGFydGluZ1ZlcnRleE5hbWVzID0gdmVydGV4TmFtZXMucmVkdWNlKGZ1bmN0aW9uKHN0YXJ0aW5nVmVydGV4TmFtZXMsIHZlcnRleE5hbWUpIHtcbiAgICAgICAgICBjb25zdCB2ZXJ0ZXggPSB2ZXJ0ZXhNYXBbdmVydGV4TmFtZV0sXG4gICAgICAgICAgICAgICAgdmVydGV4U3RhcnRpbmcgPSB2ZXJ0ZXguaXNTdGFydGluZygpO1xuXG4gICAgICAgICAgaWYgKHZlcnRleFN0YXJ0aW5nKSB7XG4gICAgICAgICAgICBjb25zdCBzdGFydGluZ1ZlcnRleE5hbWUgPSB2ZXJ0ZXhOYW1lOyAgLy8vXG5cbiAgICAgICAgICAgIHN0YXJ0aW5nVmVydGV4TmFtZXMucHVzaChzdGFydGluZ1ZlcnRleE5hbWUpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiBzdGFydGluZ1ZlcnRleE5hbWVzXG4gICAgICAgIH0sIFtdKTtcblxuICByZXR1cm4gc3RhcnRpbmdWZXJ0ZXhOYW1lcztcbn1cbiJdfQ==